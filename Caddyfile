app.exfrp.com {
    tls terran9.com@gmail.com

    # Load balanced reverse proxy to app instances
    reverse_proxy app:3000 {
        # Load balancing policy (round-robin by default)
        lb_policy round_robin
        lb_try_duration 5s
        lb_try_interval 250ms
        
        # Health check
        health_uri /health
        health_interval 10s
        health_timeout 5s
        
        # Proxy headers (required for API server)
        header_up Host {host}
        header_up X-Real-IP {remote}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
    }

    # CORS is handled by the application
}
# Redirect HTTP to HTTPS
http://app.exfrp.com {
    redir https://{host}{uri} permanent
}
